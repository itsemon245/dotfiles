#!/usr/bin/env bash
set -euo pipefail

IMAGE="${PHP84_IMAGE:-my/php:8.4-dev}"

# Map a port range so you can use 8000/8001/8002 across multiple projects.
PORT_RANGE="${PHP84_PORT_RANGE:-8000-8099}"

# Optional: mount composer cache for speed
CACHE_DIR_HOST="${XDG_CACHE_HOME:-$HOME/.cache}/composer"
mkdir -p "$CACHE_DIR_HOST"

exec docker run --rm -it \
  -u "$(id -u)":"$(id -g)" \
  -v "$PWD":/app -w /app \
  -v "$CACHE_DIR_HOST":/tmp/composer-cache \
  -e COMPOSER_CACHE_DIR=/tmp/composer-cache \
  -p "${PORT_RANGE}:${PORT_RANGE}" \
  "$IMAGE" \
  php "$@"
